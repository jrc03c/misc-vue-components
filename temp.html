<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <style>
      .x-graph {
        width: 800px;
        height: 600px;
        border: 1px solid black;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <x-graph
        :edge-draw-function="drawEdge"
        :edges="edges"
        :nodes="nodes"
        @create-new-edge="onCreateNewEdge"
        @move-node-to-top="onMoveNodeToTop">
      </x-graph>
    </div>

    <script src="node_modules/vue/dist/vue.global.prod.js"></script>
    <script src="node_modules/@jrc03c/make-key/dist/make-key.js"></script>
    <script src="dist/misc-vue-components.js"></script>
    <script>
      const { createApp } = Vue

      const app = createApp({
        components: {
          "x-graph": MiscVueComponents.Graph,
        },

        data() {
          const n1 = {
            id: makeKey(8),
            x: 64,
            y: 64,
            jacks: [],
          }

          const j1 = { id: makeKey(8), node: n1, title: "a", type: "output" }
          n1.jacks.push(j1)

          const n2 = {
            id: makeKey(8),
            x: 512,
            y: 256,
            jacks: [],
          }

          const j2 = { id: makeKey(8), node: n2, title: "b", type: "input" }
          n2.jacks.push(j2)

          return {
            edges: [],
            nodes: [n1, n2],
          }
        },

        methods: {
          drawEdge(context, p1, p2, isNew) {
            context.strokeStyle = isNew ? "red" : "black"
            context.lineWidth = 1
            context.save()

            const gap = 0
            const midx = (p1.x + gap + p2.x - gap) / 2
            context.beginPath()
            context.moveTo(p1.x + gap, p1.y)
            context.bezierCurveTo(midx, p1.y, midx, p2.y, p2.x - gap, p2.y)
            context.stroke()

            context.restore()
          },

          onCreateNewEdge(edge) {
            this.edges.push(edge)
          },

          onMoveNodeToTop(node) {
            this.nodes.splice(this.nodes.indexOf(node), 1)
            this.nodes.push(node)
          },
        },
      })

      app.mount("#app")
    </script>
  </body>
</html>
